<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
		<title>Social</title>
    </head>
    <body>
		<!-----------------loading page----------------------------->
        <div id="king">
			<h1>Social</h1>
			<div id="deviceready">
				<p>Connecting To Device</p>
			</div>
		</div>
		
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script>
		//===================globals================================
		var king = document.getElementById("king");
		var docWidth= $(document).width();
		var docHeight= $(document).height();
				
		//================device ready==============================
        app.initialize();
		
		var page={
		//===================login page=============================
			login: function(){
				
				//signup div
				handleDOM.create("signup", "DIV", king);
				signup=document.getElementById("signup");
				
				signup.innerHTML="Sign Up Now";
				signup.style.position = "absolute";
				signup.style.textAlign = "center";
				signup.style.border = "thick solid #0000FF";
				signup.style.left=docWidth*.25 + "px";
				signup.style.top=docHeight*.55 +"px";
				signup.style.width=docWidth*.5 + "px";
				signup.style.height=docHeight*.3 + "px";
				
				signup.onclick=function(){
					handleDOM.remove("signup");
					handleDOM.remove("login");
					page.signup();
				}
				
				//login div
				handleDOM.create("login", "FORM", king);
				var login=document.getElementById("login");
				
				handleDOM.create("emailDIV", "DIV", login);
				var email=document.getElementById("emailDIV");
				email.innerHTML="ASU E-Mail:<br><input id='email' type='text' />";
				
				handleDOM.create("passwordDIV", "DIV", login);
				var password=document.getElementById("passwordDIV");
				password.innerHTML="Password:<br><input id='password' type='password' />";
			
				handleDOM.create("submit", "INPUT", login);
				var submit=document.getElementById("submit");
				submit.type="button";
				submit.value="Log In";
				submit.onclick=function(){
					var hr = new XMLHttpRequest();
					var url= "http://strugglingdev-games.com/login.php";
					var em = document.getElementById("email").value;
					var pw = document.getElementById("password").value;
					var vars = "email="+em.toLowerCase()+"&password="+pw;
					hr.open("POST", url, true);
					hr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					hr.onreadystatechange = function(){
						if(hr.readyState==4 && hr.status==200){
							var return_data=hr.responseText;
						}
						
						console.log(return_data);
						if(return_data=="1"){
							submit.value = "Success!";
							var temp = em;
							handleDOM.remove("signup");
							handleDOM.remove("login");
							page.main(temp);
						}
						else if(return_data=="2"){
							submit.value = "Success!";
							var temp = em;
							handleDOM.remove("signup");
							handleDOM.remove("login");
							page.authenticate(temp);
						}
						else if(return_data=="-1"){
							//invalid password
							submit.value = "Re-Submit";
						}
						else if(return_data==-"-2"){
							//email not found
							submit.value = "Re-Submit";
						}
						else if(return_data=="-3"){
							//network communication error
							submit.value = "Re-Submit";
						}
						else{
							//unkown error
							submit.value = "Re-Submit";
						}
					}
					hr.send(vars);
					
					submit.value = "authenticating...";
				};
				
				login.style.position = "absolute";
				login.style.textAlign = "center";
				login.style.border = "thick solid #0000FF";
				login.style.left=docWidth*.25 + "px";
				login.style.top=docHeight*.15 +"px";
				login.style.width=docWidth*.5 + "px";
				login.style.height=docHeight*.3 + "px";
			},
			
		//===================sign up page============================
			signup: function(){
				var validInput=false;
			
				handleDOM.create("signup", "FORM", king);
				var signup=document.getElementById("signup");
				
				handleDOM.create("emailDIV", "DIV", signup);
				var email=document.getElementById("emailDIV");
				email.innerHTML="ASU E-Mail: <input id='email' type='text' />";
				
				console.log(validInput);
				
				handleDOM.create("passwordDIV", "DIV", signup);
				var password=document.getElementById("passwordDIV");
				password.innerHTML="Password: <input id='password' type='password' /><br>Confirm: <input id='password2' type='password' />";
				
				handleDOM.create("submit", "INPUT", signup);
				var submit = document.getElementById("submit");
				submit.type="button";
				submit.value="Create Account";
				submit.onclick=function(){
					if(document.getElementById("password").value===document.getElementById("password2").value){
						validInput=true;
					}
					if(validInput){
						validInput=false;
						var hr = new XMLHttpRequest();
						var url= "http://strugglingdev-games.com/signup.php";
						var em = document.getElementById("email").value;
						var pw = document.getElementById("password2").value;
						var vars = "email="+em.toLowerCase()+"&password="+pw;
						hr.open("POST", url, true);
						hr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
						hr.onreadystatechange = function(){
							if(hr.readyState==4 && hr.status==200){
								var return_data=hr.responseText;
								submit.value = return_data;
							}
						}
						hr.send(vars);
						submit.value = "processing...";
					}
				}
			},
		
		//==================validation page==========================
			authenticate: function(email){
				handleDOM.create("validate", "FORM", king);
				var validate=document.getElementById("validate");
				
				handleDOM.create("codeDIV", "DIV", validate);
				var codeDIV=document.getElementById("codeDIV");
				codeDIV.innerHTML="Enter Validation Code:<br><input id='code' type='text' />";
				
				handleDOM.create("submit", "INPUT", validate);
				var submit=document.getElementById("submit");
				submit.type="button";
				submit.value="submit";
				submit.onclick=function(){
						var hr = new XMLHttpRequest();
						var url= "http://strugglingdev-games.com/authenticate.php";
						var code = document.getElementById("code").value;
						var vars = "code="+code+"&email="+email;
						hr.open("POST", url, true);
						hr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
						hr.onreadystatechange = function(){
							if(hr.readyState==4 && hr.status==200){
								var return_data=hr.responseText;
								
								if(return_data="1"){
									submit.value="Verified!";
								}
								else if(return_data=="2"){
									submit.value="Re-Submit";
								}
								else{
									alert("ERROR");
									submit.value="ERROR";
								}
							}
						}
						hr.send(vars);
						submit.value = "verifying...";
				}
			},
		//==================main page==================================
			main: function(email){
				alert("Welcome to the main page. Currently under construction.");
			}
		}
		</script>
    </body>
</html>
